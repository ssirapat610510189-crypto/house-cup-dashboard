<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <title>House Cup - Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#f6f8fc;
      --panel:#ffffff;
      --line:#e8edf5;
      --txt:#0f172a;
      --muted:#6b7280;
      --iones:#4e8cb1;
      --viridian:#568d62;
      --astra:#8970a7;
      --forj:#833c3c;
      --radius:18px;
    }

    *{box-sizing:border-box;}

    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans Thai","Noto Sans",sans-serif;
      background:var(--bg);
      color:var(--txt);
    }

    .wrap{
      max-width:1200px;
      margin:0 auto;
      padding:20px 16px 40px;
    }

    /* Top bar */
    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:10px 0 20px;
      position:sticky;
      top:0;
      background:var(--bg);
      z-index:10;
    }

    .brand{
      font-weight:700;
      font-size:20px;
    }

    .tabs{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }

    .tab-btn{
      border-radius:999px;
      padding:8px 18px;
      border:1px solid transparent;
      background:#eef1f7;
      font-size:14px;
      cursor:pointer;
    }
    .tab-btn.active{
      background:#111827;
      color:#fff;
      border-color:#111827;
    }

    /* Panels */
    .panel{
      background:var(--panel);
      border-radius:24px;
      padding:24px 24px 20px;
      box-shadow:0 8px 24px rgba(15,23,42,.06);
      border:1px solid #e5e7eb;
    }

    .panel-header{
      margin-bottom:16px;
    }
    .panel-title{
      font-weight:700;
      font-size:18px;
      margin-bottom:2px;
    }
    .panel-sub{
      font-size:13px;
      color:var(--muted);
    }

    /* Grid cards overview */
    .grid-2{
      display:grid;
      grid-template-columns:repeat(2,minmax(0,1fr));
      gap:18px;
      margin-top:12px;
    }

    @media(max-width:768px){
      .grid-2{
        grid-template-columns:1fr;
      }
    }

    .house-card{
      border-radius:var(--radius);
      border:1px solid var(--line);
      background:#fbfcff;
      padding:20px 22px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      min-height:160px;
    }

    .house-card-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:18px;
    }
    .house-name{
      font-weight:700;
      font-size:16px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .dot{
      width:10px;
      height:10px;
      border-radius:999px;
      background:#000;
    }
    .badge-rank{
      font-size:12px;
      padding:4px 10px;
      border-radius:999px;
      background:#f9fafb;
      border:1px solid #e5e7eb;
      color:var(--muted);
    }

    .score-big{
      font-size:56px;
      font-weight:800;
      letter-spacing:6px;
      line-height:1;
    }

    .score-label{
      margin-top:4px;
      font-size:13px;
      color:var(--muted);
      text-align:center;
    }

    .house-card-footer{
      text-align:center;
    }

    /* small panels bottom */
    .grid-bottom{
      display:grid;
      grid-template-columns:2fr 2fr;
      gap:18px;
      margin-top:18px;
    }
    @media(max-width:768px){
      .grid-bottom{
        grid-template-columns:1fr;
      }
    }

    .bottom-card{
      border-radius:var(--radius);
      border:1px solid var(--line);
      background:#fbfcff;
      padding:18px 22px;
      font-size:14px;
    }
    .bottom-title{
      font-weight:600;
      margin-bottom:4px;
    }
    .bottom-sub{
      color:var(--muted);
      font-size:13px;
    }

    .footer-note{
      margin-top:10px;
      font-size:11px;
      color:var(--muted);
      display:flex;
      justify-content:space-between;
      align-items:center;
    }

    /* ===== House detail view ===== */
    .view{display:none;}
    .view.active{display:block;}

    .house-header-row{
      display:flex;
      align-items:center;
      gap:12px;
      margin-bottom:18px;
    }

    .badge-total{
      border-radius:999px;
      padding:6px 14px;
      background:#111827;
      color:#fff;
      font-size:13px;
    }

    .student-grid{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
      gap:18px;
    }

    .student-card{
      background:#fbfcff;
      border-radius:var(--radius);
      border:1px solid var(--line);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height:230px;
    }

    .student-photo{
      background:#f1f5f9;
      height:120px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:12px;
      color:var(--muted);
    }

    .student-body{
      padding:10px 14px 14px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      flex:1;
    }

    .student-name{
      font-weight:600;
      font-size:14px;
    }

    .student-meta{
      font-size:12px;
      color:var(--muted);
      margin-top:2px;
      min-height:32px;
    }

    .student-score{
      margin-top:10px;
      font-size:34px;
      font-weight:800;
      text-align:center;
    }

    .student-score-label{
      font-size:11px;
      text-align:center;
      color:var(--muted);
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header class="topbar">
      <div class="brand">House Cup</div>
      <nav class="tabs">
        <button class="tab-btn active" data-target="overview">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏£‡∏ß‡∏°</button>
        <button class="tab-btn" data-target="house-iones">Iones</button>
        <button class="tab-btn" data-target="house-viridian">Viridian</button>
        <button class="tab-btn" data-target="house-astra">Astra</button>
        <button class="tab-btn" data-target="house-forj">Forj</button>
      </nav>
    </header>

    <!-- ============ OVERVIEW ============ -->
    <section class="view active" id="view-overview">
      <div class="panel">
        <div class="panel-header">
          <div class="panel-title">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏° 4 ‡∏ö‡πâ‡∏≤‡∏ô</div>
          <div class="panel-sub">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏∏‡∏Å 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</div>
        </div>

        <div class="grid-2">
          <!-- Iones -->
          <div class="house-card">
            <div class="house-card-header">
              <div class="house-name">
                <span class="dot" style="background:var(--iones);"></span>
                Iones
              </div>
              <div class="badge-rank" id="rank-iones">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö 1</div>
            </div>
            <div class="house-card-footer">
              <div class="score-big" id="score-iones" style="color:var(--iones);">0000</div>
              <div class="score-label">‡∏£‡∏ß‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
            </div>
          </div>

          <!-- Viridian -->
          <div class="house-card">
            <div class="house-card-header">
              <div class="house-name">
                <span class="dot" style="background:var(--viridian);"></span>
                Viridian
              </div>
              <div class="badge-rank" id="rank-viridian">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö 2</div>
            </div>
            <div class="house-card-footer">
              <div class="score-big" id="score-viridian" style="color:var(--viridian);">0000</div>
              <div class="score-label">‡∏£‡∏ß‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
            </div>
          </div>

          <!-- Astra -->
          <div class="house-card">
            <div class="house-card-header">
              <div class="house-name">
                <span class="dot" style="background:var(--astra);"></span>
                Astra
              </div>
              <div class="badge-rank" id="rank-astra">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö 3</div>
            </div>
            <div class="house-card-footer">
              <div class="score-big" id="score-astra" style="color:var(--astra);">0000</div>
              <div class="score-label">‡∏£‡∏ß‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
            </div>
          </div>

          <!-- Forj -->
          <div class="house-card">
            <div class="house-card-header">
              <div class="house-name">
                <span class="dot" style="background:var(--forj);"></span>
                Forj
              </div>
              <div class="badge-rank" id="rank-forj">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö 4</div>
            </div>
            <div class="house-card-footer">
              <div class="score-big" id="score-forj" style="color:var(--forj);">0000</div>
              <div class="score-label">‡∏£‡∏ß‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
            </div>
          </div>
        </div>

        <div class="grid-bottom">
  <!-- ‡∏ú‡∏π‡πâ‡πÑ‡∏î‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î -->
  <div class="bottom-card">
    <div class="bottom-title">‡∏ú‡∏π‡πâ‡πÑ‡∏î‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</div>
    <div class="bottom-sub">
      <span id="best-name">-</span>
      (<span id="best-house">-</span>)
      ‚Äî <span id="best-score">0</span> ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
    </div>
  </div>

  <!-- ‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î -->
  <div class="bottom-card">
    <div class="bottom-title">‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</div>
    <div class="bottom-sub">
      <span id="worst-name">-</span>
      (<span id="worst-house">-</span>)
      ‚Äî <span id="worst-score">0</span> ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
    </div>
  </div>
</div>


        <div class="footer-note">
          <span>‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏∏‡∏Å 10s ‚Ä¢ ‡∏à‡∏∞‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÇ‡∏ü‡∏Å‡∏±‡∏™</span>
          <span id="clock-text"></span>
        </div>
      </div>
    </section>

    <!-- ============ HOUSE DETAIL TEMPLATES ============ -->
    <!-- Iones -->
    <section class="view" id="view-house-iones">
      <div class="panel">
        <div class="house-header-row">
          <button class="tab-btn" onclick="switchView('overview')">‚Üê ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
          <div class="house-name">
            <span class="dot" style="background:var(--iones);"></span> Iones
          </div>
          <span class="badge-total">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°: <span id="detail-total-iones">0</span></span>
        </div>

        <div class="student-grid" id="grid-iones"></div>
      </div>
    </section>

    <!-- Viridian -->
    <section class="view" id="view-house-viridian">
      <div class="panel">
        <div class="house-header-row">
          <button class="tab-btn" onclick="switchView('overview')">‚Üê ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
          <div class="house-name">
            <span class="dot" style="background:var(--viridian);"></span> Viridian
          </div>
          <span class="badge-total">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°: <span id="detail-total-viridian">0</span></span>
        </div>

        <div class="student-grid" id="grid-viridian"></div>
      </div>
    </section>

    <!-- Astra -->
    <section class="view" id="view-house-astra">
      <div class="panel">
        <div class="house-header-row">
          <button class="tab-btn" onclick="switchView('overview')">‚Üê ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
          <div class="house-name">
            <span class="dot" style="background:var(--astra);"></span> Astra
          </div>
          <span class="badge-total">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°: <span id="detail-total-astra">0</span></span>
        </div>

        <div class="student-grid" id="grid-astra"></div>
      </div>
    </section>

    <!-- Forj -->
    <section class="view" id="view-house-forj">
      <div class="panel">
        <div class="house-header-row">
          <button class="tab-btn" onclick="switchView('overview')">‚Üê ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
          <div class="house-name">
            <span class="dot" style="background:var(--forj);"></span> Forj
          </div>
          <span class="badge-total">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°: <span id="detail-total-forj">0</span></span>
        </div>

        <div class="student-grid" id="grid-forj"></div>
      </div>
    </section>
  </div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
  import {
    getFirestore, collection, onSnapshot, doc
  } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

  // ===== Firebase config ‡∏Ç‡∏≠‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏û‡∏µ‡πà =====
  const firebaseConfig = {
    apiKey: "AIzaSyDpOhgrbmwyJHIie-1_1ymqDEmUh2FlxqI",
    authDomain: "kl-house-cup.firebaseapp.com",
    projectId: "kl-house-cup",
    storageBucket: "kl-house-cup.firebasestorage.app",
    messagingSenderId: "1036003373032",
    appId: "1:1036003373032:web:6d9ab3f4d9db366990fe5d",
    measurementId: "G-WW0ND7G6J5"
  };

  // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // ====== ‡∏™‡∏•‡∏±‡∏ö‡πÅ‡∏ó‡πá‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö ======
  const tabButtons = document.querySelectorAll(".tab-btn[data-target]");

  tabButtons.forEach(btn=>{
    btn.addEventListener("click",()=>{
      const target = btn.dataset.target;
      switchView(target);
    });
  });

  function switchView(target){
    tabButtons.forEach(b=>{
      b.classList.toggle("active", b.dataset.target === target);
    });
    document.querySelectorAll(".view").forEach(v=>v.classList.remove("active"));

    if(target === "overview"){
      document.getElementById("view-overview").classList.add("active");
    }else{
      document.getElementById("view-" + target).classList.add("active");
      const houseKey = target.replace("house-","");
      renderHouseDetail(houseKey);
    }
  }
window.switchView = switchView;
  // ====== ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ö‡πâ‡∏≤‡∏ô‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ ======
  const houseData = {
    iones: { total:0, students:[] },
    viridian: { total:0, students:[] },
    astra: { total:0, students:[] },
    forj: { total:0, students:[] }
  };
let bestStudent = null;
let worstStudent = null;
  // ====== ‡∏î‡∏∂‡∏á students realtime ‡∏à‡∏≤‡∏Å Firestore ======
  const studentsRef = collection(db,"students");
  onSnapshot(studentsRef, (snap)=>{
  // reset house
  Object.keys(houseData).forEach(h=>{
    houseData[h].total = 0;
    houseData[h].students = [];
  });

  // reset best/worst
  bestStudent = null;
  worstStudent = null;

  snap.forEach(docSnap=>{
    const st = docSnap.data();
    const h = st.house;
    if(!houseData[h]) return;

    // ‚úî ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏°‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 2 ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á
    const rawScore = parseFloat(st.score ?? 0) || 0;
    const score = Math.round(rawScore * 100) / 100;

    const studentObj = {
      id: docSnap.id,
      name: st.name,
      meta: st.subtitle,
      score,
      house: h,
      photoURL: st.photoURL || ""
    };

    houseData[h].students.push(studentObj);
    houseData[h].total += score;

    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡∏ô‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ö‡∏ß‡∏Å)
    if (!bestStudent || score > bestStudent.score) {
      bestStudent = studentObj;
    }

    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà "‡∏ï‡∏¥‡∏î‡∏•‡∏ö" ‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
    // ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç: ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô < 0 ‡πÅ‡∏•‡∏∞ ‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
    if (score < 0) {
      if (!worstStudent || score < worstStudent.score) {
        worstStudent = studentObj;
      }
    }
  });

  renderOverview();
  //renderExtremes(); // ‚Üê ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ

  // ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤ house ‡πÉ‡∏î‡∏≠‡∏¢‡∏π‡πà ‡πÉ‡∏´‡πâ refresh ‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢
  const active = document.querySelector(".view.active");
  if(active && active.id.startsWith("view-house-")){
    const key = active.id.replace("view-house-","");
    renderHouseDetail(key);
  }
});

  // ====== ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏ß‡∏° 4 ‡∏ö‡πâ‡∏≤‡∏ô ======
function renderOverview(){
  // ‡∏™‡∏£‡πâ‡∏≤‡∏á object ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°
  const totals = {
    iones: houseData.iones.total,
    viridian: houseData.viridian.total,
    astra: houseData.astra.total,
    forj: houseData.forj.total
  };

  // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô array + ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏°‡∏≤‡∏Å ‚Üí ‡∏ô‡πâ‡∏≠‡∏¢
  const ranking = Object.entries(totals)
    .sort((a,b)=> b[1] - a[1])   // sort by score desc
    .map(([key,score],idx)=>({ key, score, rank:idx+1 }));

  // ‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á div ‡πÄ‡∏î‡∏¥‡∏°
  const container = document.querySelector(".grid-2");

  // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤
  container.innerHTML = "";

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á card DOM
  const createCard = (houseKey, score, rank) => {
    const colors = {
      iones: "var(--iones)",
      viridian: "var(--viridian)",
      astra: "var(--astra)",
      forj: "var(--forj)"
    };

    const html = `
      <div class="house-card">
        <div class="house-card-header">
          <div class="house-name">
            <span class="dot" style="background:${colors[houseKey]};"></span>
            ${houseKey.charAt(0).toUpperCase() + houseKey.slice(1)}
          </div>
          <div class="badge-rank">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö ${rank}</div>
        </div>
        <div class="house-card-footer">
          <div class="score-big" style="color:${colors[houseKey]}">
            ${Number(score).toFixed(2).padStart(4,"0")}
          </div>
          <div class="score-label">‡∏£‡∏ß‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
        </div>
      </div>
    `;
    return html;
  };


  // ‡πÄ‡∏û‡∏¥‡πà‡∏° card ‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÉ‡∏´‡∏°‡πà (‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö 1 ‚Üí 4)
  ranking.forEach(item => {
    container.innerHTML += createCard(item.key, item.score, item.rank);
  });
}


  // ====== ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ö‡πâ‡∏≤‡∏ô ======
  function renderHouseDetail(houseKey){
  const grid = document.getElementById("grid-" + houseKey);
  const totalSpan = document.getElementById("detail-total-" + houseKey);

  const originalList = houseData[houseKey].students || [];
  const list = [...originalList].sort((a, b) => (b.score || 0) - (a.score || 0));

  grid.innerHTML = "";
  let houseTotal = 0;

  list.forEach((st, idx)=> {
    const score = st.score || 0;
    houseTotal += score;

    // üîπ ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏ô ‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 2 ‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏°
    const displayScore = Number(score.toFixed(2));

    const card = document.createElement("div");
    card.className = "student-card";
    const directPhotoURL = getDirectDriveLink(st.photoURL);
    const imgHTML = directPhotoURL
      ? `<img src="${directPhotoURL}" alt="${st.name}"
             style="width:100%;height:100%;object-fit:cover;border-radius:16px 16px 0 0;"
             loading="lazy">` // ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏™‡πà loading="lazy" ‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö
      : `<div style="display:flex;align-items:center;justify-content:center;height:100%;color:var(--muted);">‡∏£‡∏π‡∏õ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</div>`;
    card.innerHTML = `
      <div class="student-photo">
        ${imgHTML}
      </div>
      <div class="student-body">
        <div>
          <div class="student-name">
            #${idx+1} ‚Äî ${st.name}
          </div>
          <div class="student-meta">${st.meta || ""}</div>
        </div>
        <div>
          <div class="student-score">${displayScore}</div>
          <div class="student-score-label">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°</div>
        </div>
      </div>
    `;
    grid.appendChild(card);
  });

  // üîπ ‡∏£‡∏ß‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ö‡πâ‡∏≤‡∏ô ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 2 ‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏°
  totalSpan.textContent = Number(houseTotal.toFixed(2));
}
  // ‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤‡∏°‡∏∏‡∏°‡∏•‡πà‡∏≤‡∏á‡∏Ç‡∏ß‡∏≤
  function tickClock(){
    const now = new Date();
    const t = now.toLocaleTimeString("th-TH",{hour12:false});
    document.getElementById("clock-text").textContent = t;
  }
  tickClock();
  setInterval(tickClock,1000);

  // render ‡∏£‡∏≠‡∏ö‡πÅ‡∏£‡∏Å (‡πÄ‡∏ú‡∏∑‡πà‡∏≠ Firestore ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏≠‡∏ö)
  renderOverview();
  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå Google Drive
function getDirectDriveLink(url) {
  if (!url) return "";
  // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå Drive ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÅ‡∏õ‡∏•‡∏á‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°
  if (!url.includes("drive.google.com")) return url;
  
  // ‡∏î‡∏∂‡∏á ID ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå
  const idMatch = url.match(/\/d\/(.*?)\//);
  if (idMatch && idMatch[1]) {
    return `https://drive.google.com/uc?export=view&id=${idMatch[1]}`;
  }
  return url;
}
</script>
</body>
</html>

